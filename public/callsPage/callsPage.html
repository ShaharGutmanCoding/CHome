<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Requests</title>
    <style>
      .Request {
        border: 1px solid #ddd;
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
        background-color: #f9f9f9;
        font-size: 16px;
        margin-bottom: 20px;
        margin-left: auto;
        margin-right: auto;
        max-width: 700px;
        position: relative;
        overflow: hidden; 
        word-wrap: break-word; 
      }
      .Request span:last-child {
        position: absolute;
        bottom: 5px;
        left: 10px;
        font-size: 10px;
        margin-top: 10px;
      }
      .read-more {
        display: none;
      }
      .show-more {
        cursor: pointer;
        color: blue;
        text-decoration: underline;
      }
    </style>
    <script>
      $(function () {
          $("#header").load("./header/header.html");
      });
    </script>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>
  <h1 class="text-center">All Requests</h1>
  <div class="container text-center">
    <h4 id="counter" class="text-center">there are 0 requests</h4>
    <div id="requestsContainer"></div>
  </div>
  
  <script src="./callsPage.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

</body>
</html>

<script>
let counter = document.getElementById("counter");
let requestsContainer = document.getElementById("requestsContainer");

function createCall(object) {
  let div = document.createElement("div");
  div.classList.add("Request");

  // Create a span for the prescription
  let prescription = document.createElement("span");
  prescription.textContent = object.category;
  prescription.style.display = "block"; 
  prescription.style.textAlign = "center";
  prescription.style.textDecoration = "underline"; 
  prescription.style.fontWeight = "bold";
  div.appendChild(prescription);

  // Create a span for the description
  let description = document.createElement("span");
  description.textContent = object.description;
  description.classList.add("description");

  // Check if the description is too long
  if (description.textContent.length > 100) {
    let shortText = description.textContent.substring(0, 100);
    let fullText = description.textContent;

    description.textContent = shortText + "...";
    
    let readMoreButton = document.createElement("span");
    readMoreButton.textContent = "המשך קריאה";
    readMoreButton.classList.add("show-more");
    
    readMoreButton.onclick = function() {
      description.textContent = fullText;
      readMoreButton.style.display = "none";
    };

    div.appendChild(description);
    div.appendChild(readMoreButton);
  } else {
    div.appendChild(description);
  }

  // Create a span for the date
  let date = document.createElement("span");
  date.textContent = object.date;
  date.style.display = "block"; 
  date.style.fontSize = "10px"; 
  date.style.textAlign = "left"; 
  div.appendChild(date);

  requestsContainer.appendChild(div);
}

fetch('/callsPage/getCalls')
.then(response => response.json())
.then(data => {
  counter.innerHTML = "There are " + data.length + " requests";
  for (let i = 0; i < data.length; i++)
    createCall(data[i]);
});
</script>
